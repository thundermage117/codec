<!-- /*
 * Codec Explorer: An interactive codec laboratory.
 * Copyright (C) 2026 Abhinav Tanniru
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program. If not, see <https://www.gnu.org/licenses/>.
 */ -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WASM Codec Explorer</title>

    <!-- Prevent the browser from requesting a favicon, which would cause a 404 error -->
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">

    <!-- Google Fonts: Inter + JetBrains Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="css/style.css">

    <!-- Theme init: apply saved/system theme before first paint to prevent flash -->
    <script>
        (function () {
            const saved = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (saved === 'dark' || (!saved && prefersDark)) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>
</head>

<body>

    <header>
        <h1>WASM Codec Explorer</h1>
        <div class="header-badges">
            <div class="privacy-badge">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                    stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
                <span>Processed locally on your device</span>
            </div>
            <a href="https://github.com/thundermage117/codec" class="github-link" target="_blank"
                rel="noopener noreferrer">
                <img src="assets/GitHub_Invertocat_Black.svg" alt="GitHub Logo" width="16" height="16">
                <span>View Source on GitHub</span>
            </a>
            <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
                <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round" style="display:none;">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
        </div>
    </header>

    <div class="container">
        <div class="card">
            <div class="canvas-wrapper" id="viewer-container">
                <div class="viewer-info">
                    üí° Tip: Click and drag on the image to move the slider.
                </div>
                <div class="comparison-viewer">
                    <canvas id="originalCanvas"></canvas>
                    <canvas id="processedCanvas"></canvas>
                </div>

                <div class="slider-container">
                    <span class="slider-label">Original</span>
                    <input type="range" id="comparisonSlider" class="comparison-slider-input" min="0" max="100"
                        value="50">
                    <span class="slider-label">Processed</span>
                </div>
            </div>
        </div>

        <div class="card controls">
            <!-- Drop Zone / Onboarding -->
            <div class="drop-zone" id="dropZone">
                <svg class="drop-zone-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                    stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <path d="M21 15l-5-5L5 21"></path>
                </svg>
                <div class="drop-zone-text">Drop an image here</div>
                <div class="drop-zone-hint">or <span class="browse-link">browse to upload</span></div>
                <input type="file" id="fileInput" accept="image/*" disabled>
            </div>

            <div class="control-group">
                <label for="qualitySlider">
                    Quality <span id="qualityValue">50</span>
                </label>
                <div class="preset-group">
                    <button class="preset-btn" data-quality="10" disabled>
                        <span class="preset-label">Low</span>
                        <span class="preset-desc">Thumbnails</span>
                    </button>
                    <button class="preset-btn" data-quality="50" disabled>
                        <span class="preset-label">Medium</span>
                        <span class="preset-desc">Web / Social</span>
                    </button>
                    <button class="preset-btn" data-quality="90" disabled>
                        <span class="preset-label">High</span>
                        <span class="preset-desc">Print / Archive</span>
                    </button>
                </div>
                <input type="range" id="qualitySlider" min="1" max="100" value="50" disabled>
            </div>

            <div class="control-group">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px;">
                    <label class="group-label" style="margin-bottom: 0;">View Mode</label>
                    <div class="tint-toggle"
                        style="display: flex; align-items: center; gap: 4px; font-size: 0.8rem; color: var(--text-muted);">
                        <input type="checkbox" id="tint_toggle" checked style="margin: 0; cursor: pointer;">
                        <label for="tint_toggle" style="margin-bottom: 0; cursor: pointer; font-weight: normal;">Cb/Cr
                            Tint</label>
                        <div class="tooltip-container">
                            <span class="info-icon">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                            </span>
                            <div class="tooltip-content">
                                <strong>Why remove the tint?</strong><br>
                                The human eye is biologically wired to detect changes in brightness (Luminance) far
                                better than changes in color (Chrominance). Viewing these channels in grayscale helps
                                you see fine details and artifacts that get lost in the color tint. This same biological
                                limitation is the foundation of image compression (like JPEG)‚Äîcodecs aggressively
                                compress color data because our eyes rarely notice the difference.
                            </div>
                        </div>
                    </div>
                </div>
                <div class="toggle-group">
                    <input type="radio" id="view_rgb" name="view_mode" value="rgb" checked>
                    <label for="view_rgb">RGB</label>

                    <input type="radio" id="view_artifacts" name="view_mode" value="artifacts">
                    <label for="view_artifacts">Error</label>

                    <input type="radio" id="view_y" name="view_mode" value="y">
                    <label for="view_y">Y</label>

                    <input type="radio" id="view_cr" name="view_mode" value="cr">
                    <label for="view_cr">Cr</label>

                    <input type="radio" id="view_cb" name="view_mode" value="cb">
                    <label for="view_cb">Cb</label>
                </div>
            </div>

            <div class="control-group">
                <label class="group-label">Tools</label>
                <div class="toggle-group">
                    <input type="checkbox" id="inspect_mode" style="display:none;">
                    <label for="inspect_mode" id="inspect_label" class="tool-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        Inspect Block
                    </label>
                </div>
            </div>

            <div class="control-group">
                <label class="group-label">Chroma Subsampling</label>
                <div class="toggle-group">
                    <input type="radio" id="cs_444" name="chroma_subsampling" value="444" checked>
                    <label for="cs_444">4:4:4</label>

                    <input type="radio" id="cs_422" name="chroma_subsampling" value="422">
                    <label for="cs_422">4:2:2</label>

                    <input type="radio" id="cs_420" name="chroma_subsampling" value="420">
                    <label for="cs_420">4:2:0</label>
                </div>
            </div>

            <div class="stats">Status: <span id="status">Initializing...</span></div>

            <table class="metrics-table">
                <thead>
                    <tr>
                        <th>Channel</th>
                        <th>PSNR (dB)</th>
                        <th>SSIM</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Y</td>
                        <td><span id="psnrY">-</span></td>
                        <td><span id="ssimY">-</span></td>
                    </tr>
                    <tr>
                        <td>Cr</td>
                        <td><span id="psnrCr">-</span></td>
                        <td><span id="ssimCr">-</span></td>
                    </tr>
                    <tr>
                        <td>Cb</td>
                        <td><span id="psnrCb">-</span></td>
                        <td><span id="ssimCb">-</span></td>
                    </tr>
                </tbody>
            </table>

            <div class="file-size-bar-container" id="fileSizeContainer" style="display: none;">
                <div class="file-size-header">
                    <span class="file-size-title">Estimated File Size</span>
                    <span class="file-size-values" id="fileSizeValues">‚Äî</span>
                </div>
                <div class="file-size-track">
                    <div class="file-size-fill" id="fileSizeFill" style="width: 100%;"></div>
                </div>
                <div class="file-size-labels">
                    <span class="file-size-label-left" id="fileSizeOrigLabel">Original: ‚Äî</span>
                    <span class="file-size-label-right" id="fileSizeReduction">‚Äî</span>
                </div>
            </div>
        </div>

        <!-- Block Inspector (inline, below image) -->
        <div id="inspectionPanel" class="inspector-inline" style="display: none;">
            <!-- Header -->
            <div class="inspector-header">
                <div class="inspector-title-row">
                    <h2 class="inspector-title">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        Block Inspector
                    </h2>
                    <div class="inspector-badges">
                        <span class="inspector-badge badge-coords">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            <span id="blockCoords">‚Äî</span>
                        </span>
                        <span class="inspector-badge badge-qtable" id="qTableType">Luma</span>
                    </div>
                </div>
                <!-- Color Legend -->
                <div class="inspector-legend">
                    <span class="legend-item">
                        <span class="legend-dot dot-positive"></span>Positive
                    </span>
                    <span class="legend-item">
                        <span class="legend-dot dot-negative"></span>Negative
                    </span>
                    <span class="legend-item">
                        <span class="legend-dot dot-zero"></span>Near Zero
                    </span>
                    <span class="legend-item">
                        <span class="legend-dot dot-intensity"></span>Pixel Intensity
                    </span>
                </div>
            </div>

            <!-- Placeholder (shown before first block click) -->
            <div id="inspectorPlaceholder" class="inspector-placeholder">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                    stroke-linecap="round" stroke-linejoin="round" opacity="0.35">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <p>Click a block on the image to inspect it</p>
            </div>

            <!-- Pipeline Content (hidden until a block is selected) -->
            <div id="inspectorContent" style="display: none;">

                <!-- ROW 1: Encoding (left ‚Üí right) -->
                <div class="inspector-row-label label-encode">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                        <polyline points="12 5 19 12 12 19"></polyline>
                    </svg>
                    Encoding
                </div>
                <div class="inspector-row">
                    <div class="inspection-section">
                        <div class="header-with-tooltip">
                            <h3>Original Pixels</h3>
                            <div class="tooltip-container">
                                <span class="info-icon-small">?</span>
                                <div class="tooltip-content-small">
                                    Raw pixel values (0‚Äì255) from the source image for this 8√ó8 block.
                                </div>
                            </div>
                        </div>
                        <div id="gridOriginal" class="block-grid"></div>
                    </div>

                    <div class="pipeline-arrow-h arrow-encode">
                        <span class="arrow-label">DCT Transform</span>
                        <span class="arrow-icon">‚Üí</span>
                        <div class="tooltip-container">
                            <span class="info-icon-small">?</span>
                            <div class="tooltip-content-small tooltip-wide">
                                <strong>Discrete Cosine Transform</strong><br>
                                Converts pixel values into a weighted sum of cosine wave patterns at different
                                frequencies. Each cell in the output represents <em>how much</em> of a particular
                                frequency pattern is present in this block.
                            </div>
                        </div>
                    </div>

                    <div class="inspection-section">
                        <div class="header-with-tooltip">
                            <h3>DCT Coefficients</h3>
                            <div class="tooltip-container">
                                <span class="info-icon-small">?</span>
                                <div class="tooltip-content-small tooltip-wide">
                                    Each cell = strength of a cosine wave pattern.<br>
                                    <strong>Top-left (0,0)</strong>: DC ‚Äî average brightness of the block.<br>
                                    <strong>Bottom-right</strong>: High-freq ‚Äî fine edges &amp; detail.<br><br>
                                    <strong style="color: #ef4444;">Positive</strong>: The wave adds brightness
                                    (constructive).<br>
                                    <strong style="color: #3b82f6;">Negative</strong>: The wave subtracts brightness
                                    (inverts).<br><br>
                                    üí° Low-frequency coefficients (top-left) carry most visual information.
                                </div>
                            </div>
                        </div>
                        <div id="gridDCT" class="block-grid"></div>
                    </div>

                    <div class="pipeline-arrow-h arrow-encode">
                        <span class="arrow-label">√∑ Quant Table</span>
                        <span class="arrow-icon">‚Üí</span>
                        <div class="tooltip-container">
                            <span class="info-icon-small">?</span>
                            <div class="tooltip-content-small tooltip-wide">
                                <strong>Quantization (Lossy Step)</strong><br>
                                Each DCT coefficient is divided by the corresponding value in
                                the Quantization Table, then <em>rounded to the nearest integer</em>.
                                This rounding is where information is permanently lost.
                            </div>
                        </div>
                    </div>

                    <div class="inspection-section">
                        <div class="header-with-tooltip">
                            <h3>Quantized</h3>
                            <div class="tooltip-container">
                                <span class="info-icon-small">?</span>
                                <div class="tooltip-content-small">
                                    Compressed coefficients. Values rounded to integers ‚Äî this is where data is lost.
                                    Zeros = saved space.
                                </div>
                            </div>
                        </div>
                        <div id="gridQuantized" class="block-grid"></div>
                    </div>
                </div>

                <!-- ROW 2: Decoding (right ‚Üí left) -->
                <div class="inspector-row-label label-decode">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                    Decoding
                </div>
                <div class="inspector-row">
                    <div class="inspection-section">
                        <div class="header-with-tooltip">
                            <h3>Reconstructed</h3>
                            <div class="tooltip-container">
                                <span class="info-icon-small">?</span>
                                <div class="tooltip-content-small">
                                    Final pixel values after inverse DCT. Compare with Original to see what changed.
                                </div>
                            </div>
                        </div>
                        <div id="gridReconstructed" class="block-grid"></div>
                    </div>

                    <div class="pipeline-arrow-h arrow-decode">
                        <span class="arrow-icon">‚Üê</span>
                        <span class="arrow-label">IDCT Transform</span>
                        <div class="tooltip-container">
                            <span class="info-icon-small">?</span>
                            <div class="tooltip-content-small tooltip-wide">
                                <strong>Inverse DCT</strong><br>
                                Converts frequency coefficients back into pixel values by
                                summing all the cosine wave patterns weighted by their coefficients.
                                The result is the reconstructed 8√ó8 pixel block.
                            </div>
                        </div>
                    </div>

                    <div class="inspection-section">
                        <div class="header-with-tooltip">
                            <h3>Dequantized</h3>
                            <div class="tooltip-container">
                                <span class="info-icon-small">?</span>
                                <div class="tooltip-content-small">
                                    Approximate DCT coefficients recovered by multiplying quantized values back by the
                                    table.
                                </div>
                            </div>
                        </div>
                        <div id="gridDequantized" class="block-grid"></div>
                    </div>

                    <div class="pipeline-arrow-h arrow-decode">
                        <span class="arrow-icon">‚Üê</span>
                        <span class="arrow-label">√ó Quant Table</span>
                        <div class="tooltip-container">
                            <span class="info-icon-small">?</span>
                            <div class="tooltip-content-small tooltip-wide">
                                <strong>Dequantization</strong><br>
                                Multiplies each quantized integer back by the table value to
                                approximate the original DCT coefficients. Since rounding already
                                lost precision, this only recovers an approximation.
                            </div>
                        </div>
                    </div>

                    <div class="inspection-section">
                        <div class="header-with-tooltip">
                            <h3>Quantized</h3>
                            <div class="tooltip-container">
                                <span class="info-icon-small">?</span>
                                <div class="tooltip-content-small">
                                    Same quantized coefficients ‚Äî this is what gets stored/transmitted.
                                </div>
                            </div>
                        </div>
                        <div id="gridQuantized2" class="block-grid"></div>
                    </div>
                </div>

                <!-- ROW 3: Analysis (3 columns) -->
                <div class="inspector-analysis-row">
                    <!-- Error / Residual -->
                    <div class="inspection-section analysis-section">
                        <div class="header-with-tooltip">
                            <h3>Error / Residual</h3>
                            <div class="tooltip-container">
                                <span class="info-icon-small">?</span>
                                <div class="tooltip-content-small">
                                    Difference: <strong>Original ‚àí Reconstructed</strong>.
                                    Shows exactly where and how much information was lost.
                                </div>
                            </div>
                        </div>
                        <div id="gridError" class="block-grid"></div>
                        <div class="inspector-stats-inline">
                            <div class="stat-item">
                                <span class="stat-label">MSE</span>
                                <span class="stat-value" id="statMSE">‚Äî</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Peak Error</span>
                                <span class="stat-value" id="statPeakError">‚Äî</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Zero Coeffs</span>
                                <span class="stat-value" id="statZeros">‚Äî</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Compression</span>
                                <span class="stat-value" id="statCompression">‚Äî</span>
                            </div>
                        </div>
                    </div>

                    <!-- Basis / Coefficient Viewer -->
                    <div class="analysis-section" id="basisViewerSection">
                        <div id="basisViewer" class="basis-viewer" style="display: none;">
                            <div class="basis-viewer-header">
                                <h3 class="basis-viewer-title">
                                    Coefficient <span id="basisCoord">(0,0)</span>
                                    <span class="inspector-badge badge-coords" id="basisFreqLabel">DC</span>
                                </h3>
                                <button class="basis-close" aria-label="Close basis viewer">&times;</button>
                            </div>
                            <div class="basis-viewer-body">
                                <div class="basis-panel">
                                    <div class="basis-panel-label">Basis Pattern</div>
                                    <div class="basis-panel-desc">Cosine wave shape</div>
                                    <canvas id="basisCanvas" width="120" height="120"></canvas>
                                </div>
                                <div class="basis-panel">
                                    <div class="basis-panel-label">Contribution</div>
                                    <div class="basis-panel-desc">Coefficient √ó Basis</div>
                                    <canvas id="contributionCanvas" width="120" height="120"></canvas>
                                </div>
                                <div class="basis-info">
                                    <div class="stat-item">
                                        <span class="stat-label">DCT Value</span>
                                        <span class="stat-value" id="basisValue">&mdash;</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Quantized</span>
                                        <span class="stat-value" id="basisQuantized">&mdash;</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">QTable Divisor</span>
                                        <span class="stat-value" id="basisDivisor">&mdash;</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="basisPlaceholder" class="inspector-placeholder-small">
                            <p>Click a DCT cell to see its basis pattern</p>
                        </div>
                    </div>

                    <!-- Quantization Table -->
                    <div class="inspection-section analysis-section">
                        <div class="header-with-tooltip">
                            <h3>Quantization Table</h3>
                            <span class="inspector-badge badge-qtable" id="qTableType2">Luma</span>
                            <div class="tooltip-container">
                                <span class="info-icon-small">?</span>
                                <div class="tooltip-content-small tooltip-wide">
                                    Each value controls how much a frequency is compressed.<br><br>
                                    <strong>Small values (top-left)</strong>: Low-frequency components are preserved
                                    carefully ‚Äî they carry most visual information (shapes, gradients).<br>
                                    <strong>Large values (bottom-right)</strong>: High-frequency details are
                                    compressed aggressively because our eyes are less sensitive.<br><br>
                                    üí° Higher quality = smaller table values = less data loss.
                                </div>
                            </div>
                        </div>
                        <div id="gridQuantTable" class="block-grid qtable-grid"></div>
                    </div>
                </div>

                <!-- ROW 4: Block Zoom (Original vs Reconstructed) -->
                <div class="inspector-zoom-row">
                    <div class="zoom-panel">
                        <div class="zoom-label">Original (8√ó8)</div>
                        <canvas id="zoomOriginal" width="8" height="8"></canvas>
                    </div>
                    <div class="zoom-vs">vs</div>
                    <div class="zoom-panel">
                        <div class="zoom-label">Reconstructed (8√ó8)</div>
                        <canvas id="zoomReconstructed" width="8" height="8"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="codec.js"></script>
    <script type="module" src="js/main.js"></script>

</body>

</html>